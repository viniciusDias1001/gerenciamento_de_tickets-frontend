<div class="tickets-page">
  <div class="container">

    <div class="header">
      <div>
        <h1 class="mt-4">Tickets</h1>
        <ol class="breadcrumb mb-4 custom-breadcrumb">
          <li class="breadcrumb-item active">
            Lista de tickets (filtros por status/prioridade)
          </li>
        </ol>
      </div>

      <div class="header-actions">
        <a class="btn btn-success" routerLink="/home/tickets/novo">
          + Novo Ticket
        </a>
      </div>
    </div>

    <div class="card filters-card">
      <div class="card-body">
        <form [formGroup]="form" (ngSubmit)="applyFilters()" class="filters">

          <div class="field">
            <label>Buscar</label>
            <input class="form-control" formControlName="q" placeholder="ID ou t√≠tulo..." />
          </div>

          <div class="field">
            <label>Status</label>
            <select class="form-control" formControlName="status">
              <option value="">Todos</option>
              <option value="OPEN">Aberto</option>
              <option value="IN_PROGRESS">Em andamento</option>
              <option value="DONE">Conclu√≠do</option>
            </select>
          </div>

          <div class="field">
            <label>Prioridade</label>
            <select class="form-control" formControlName="priority">
              <option value="">Todas</option>
              <option value="LOW">Baixa</option>
              <option value="MEDIUM">M√©dia</option>
              <option value="HIGH">Alta</option>
            </select>
          </div>

          <div class="field small">
            <label>Por p√°gina</label>
            <select class="form-control" formControlName="size">
              <option [ngValue]="10">10</option>
              <option [ngValue]="20">20</option>
              <option [ngValue]="50">50</option>
            </select>
          </div>

          <div class="actions">
            <button class="btn btn-primary" type="submit" [disabled]="loading">
              Filtrar
            </button>
            <button class="btn btn-outline-secondary" type="button" (click)="clearFilters()" [disabled]="loading">
              Limpar
            </button>
          </div>

        </form>
      </div>
    </div>

    <div class="alert alert-danger" *ngIf="errorMsg">{{ errorMsg }}</div>

    <div class="card table-card">
      <div class="card-body">

        <div class="table-top">
          <div *ngIf="page">
            <span class="muted">
              Total: <b>{{ page.totalElements }}</b> ‚Ä¢ P√°gina <b>{{ page.number + 1 }}</b> de <b>{{ page.totalPages }}</b>
            </span>
          </div>

          <div class="muted" *ngIf="loading">Carregando...</div>
        </div>

        <div class="table-responsive">
          <table class="table table-hover align-middle tickets-table" *ngIf="page">
            <thead>
              <tr>
                <th style="width: 140px;">#</th>
                <th>T√≠tulo</th>
                <th style="width: 140px;">Status</th>
                <th style="width: 140px;">Prioridade</th>
                <th style="width: 200px;">Criado por</th>
                <th style="width: 200px;">Respons√°vel</th>
                <th style="width: 140px;">A√ß√µes</th>

              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let t of page.content">
                <td class="mono">{{ t.id }}</td>

                <td>
                  <div class="title">
  <a class="ticket-link" [routerLink]="['/home/tickets', t.id]">
    {{ t.title }}
  </a>
</div>
                  <div class="sub muted">
                    Atualizado: {{ t.updatedAt | date:'dd/MM/yyyy HH:mm' }}
                  </div>
                </td>

                <td>
                  <span class="badge status"
                        [class.open]="t.status==='OPEN'"
                        [class.progress]="t.status==='IN_PROGRESS'"
                        [class.done]="t.status==='DONE'">
                    {{ statusLabel(t.status) }}
                  </span>
                </td>

                <td>
                  <span class="badge priority"
                        [class.low]="t.priority==='LOW'"
                        [class.medium]="t.priority==='MEDIUM'"
                        [class.high]="t.priority==='HIGH'">
                    {{ priorityLabel(t.priority) }}
                  </span>
                </td>

                <td class="muted">
                  {{ t.createdBy.name || '-' }}
                </td>

                <td class="muted">
                  {{ t.assignedTo?.name || 'N√£o atribu√≠do' }}
                </td>

                          <td>
  <a
    class="btn btn-sm btn-outline-primary"
    [routerLink]="['/home/tickets', t.id, 'manage']"
  >
    Gerenciar
  </a>

    <button
    id="lixo"
    class="btn btn-outline-danger btn-sm"
    *ngIf="isAdmin"
    (click)="confirmDelete(t)"
    title="Excluir ticket"
  >
    üóë
  </button>
  
</td>
                
              </tr>

              <tr *ngIf="page.content.length === 0">
                <td colspan="6" class="muted text-center py-4">
                  Nenhum ticket encontrado com os filtros atuais.
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pagination" *ngIf="page">
          <button class="btn btn-outline-secondary" (click)="prev()" [disabled]="page.first || loading">
            ‚óÄ Anterior
          </button>

          <button class="btn btn-outline-secondary" (click)="next()" [disabled]="page.last || loading">
            Pr√≥xima ‚ñ∂
          </button>
        </div>

      </div>
    </div>

  </div>
</div>
